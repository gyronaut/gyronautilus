<html>
<head>
	<title> g y r o n a u t i l u s </title>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	<script type="text/javascript">
	
	var area_name;
	var is_deer_blank = false;
	var is_sky_blank = false;
	
	var bg_image = new Image(); 
	var blank_sky = new Image();
	
	var is_active = false;
	
	var bird_animation_array = new Array();
	bird_animation_array[0] = new Image();
	bird_animation_array[1] = new Image();
	bird_animation_array[2] = new Image();
	bird_animation_array[3] = new Image();
	bird_animation_array[4] = new Image();
	bird_animation_array[5] = new Image();
	bird_animation_array[6] = new Image();
	
	var bird_frame_pos_array = new Array();
	bird_frame_pos_array[0] = {top: 342, left: 299};
	bird_frame_pos_array[1] = {top: 329, left: 319};
	bird_frame_pos_array[2] = {top: 329, left: 319};
	bird_frame_pos_array[3] = {top: 79, left: 57};
	bird_frame_pos_array[4] = {top: 79, left: 57};
	bird_frame_pos_array[5] = {top: 342, left: 299};
	bird_frame_pos_array[6] = {top: 329, left: 319};	
	
	var blank_deer = new Image();
	var blank_deer_animation_array = new Array();
	blank_deer_animation_array[0] = new Image();
	blank_deer_animation_array[1] = new Image();
	blank_deer_animation_array[2] = new Image();
	blank_deer_animation_array[3] = new Image();
	blank_deer_animation_array[4] = new Image();
	blank_deer_animation_array[5] = new Image();
	blank_deer_animation_array[6] = new Image();
	
	blank_deer_frame_pos_array = new Array();
	blank_deer_frame_pos_array[0] = {top: 79, left: 57};
	blank_deer_frame_pos_array[1] = {top: 107, left: 95};
	blank_deer_frame_pos_array[2] = {top: 174, left: 102};
	blank_deer_frame_pos_array[3] = {top: 239, left: 116};
	blank_deer_frame_pos_array[4] = {top: 239, left: 194};
	blank_deer_frame_pos_array[5] = {top: 239, left: 262};
	blank_deer_frame_pos_array[6] = {top: 253, left: 301};
	
	$('document').ready(function(){		
		var context = $('#test_canvas')[0].getContext('2d');
		
		initImages();
		
		bg_image.onload = function(){
			context.drawImage(bg_image, 0, 0);
		};
		
		$('#test_canvas').on('mousemove', function(event){
		var x = event.pageX - $('#test_canvas').offset().left;
		var y = event.pageY - $('#test_canvas').offset().top;
		
		$('#output').html('( '+ x + ', ' + y + ' )');
		
		getAreaName(x, y);
		
		});
		
		$('#test_canvas').on('click', function(event){
			var x = event.pageX - $('#test_canvas').offset().left;
			var y = event.pageY - $('#test_canvas').offset().top;
			changeCanvas(x, y);
		});
			
	});
	
	function initImages(){	
		bg_image.src = "doe-med.jpg";
		blank_deer.src = "doe-blank.png";
		blank_sky.src = "blank-sky.png";
		
		bird_animation_array[0].src = "bird-animation/bird-emerge-frame-1.png";
		bird_animation_array[1].src = "bird-animation/bird-emerge-frame-2.png";
		bird_animation_array[2].src = "bird-animation/bird-frame-1.png";
		bird_animation_array[3].src = "bird-animation/bird-frame-2.png";
		bird_animation_array[4].src = "bird-animation/bird-frame-3.png";
		bird_animation_array[5].src = "bird-animation/bird-frame-4.png";
		bird_animation_array[6].src = "bird-animation/bird-frame-5.png";
	
		blank_deer_animation_array[0].src = "blank-doe-animation/blank-doe-frame-1.png";
		blank_deer_animation_array[1].src = "blank-doe-animation/blank-doe-frame-2.png";
		blank_deer_animation_array[2].src = "blank-doe-animation/blank-doe-frame-3.png";
		blank_deer_animation_array[3].src = "blank-doe-animation/blank-doe-frame-4.png";
		blank_deer_animation_array[4].src = "blank-doe-animation/blank-doe-frame-5.png";
		blank_deer_animation_array[5].src = "blank-doe-animation/blank-doe-frame-6.png";
		blank_deer_animation_array[6].src = "blank-doe-animation/blank-doe-frame-7.png";
	}
	
	
	function isInDeer(x,y)
	{
		var ctx = $('#test_canvas')[0].getContext('2d');
		ctx.moveTo(60, 50);
		ctx.beginPath();
		ctx.lineTo(90, 50);
		ctx.lineTo(135, 115);
		ctx.lineTo(200, 115);
		ctx.lineTo(235, 75);
		ctx.lineTo(305, 50);
		ctx.lineTo(295, 105);
		ctx.lineTo(260, 135);
		ctx.lineTo(215, 140);
		ctx.lineTo(215, 280);
		ctx.lineTo(370, 250);
		ctx.lineTo(540, 285);
		ctx.lineTo(605, 330);
		ctx.lineTo(615, 425);
		ctx.lineTo(160, 470);
		ctx.lineTo(190, 440);
		ctx.lineTo(130, 360);
		ctx.lineTo(130, 235);
		ctx.lineTo(110, 155);
		ctx.lineTo(80, 120);
		ctx.closePath();
		
		return ctx.isPointInPath(x, y);
		
	}
	
	function getAreaName(x, y)
	{
		if(isInDeer(x, y)){
			area_name = "deer";
		}else if(y < 240){
			area_name = "sky";
		}else{
			area_name = "ground";
		}
		$('#output').append('<h5>'+ area_name +'</h5>');
	}
	
	function doBirdAnimation(frame_num, left, top)
	{
		var ctx = $('#test_canvas')[0].getContext('2d');
		var new_left = left+40;
		var new_top = top-30;
		var frame_index = 0;
		if(new_left < 700 && new_top > -86){
			if(frame_num < 2){
				setTimeout(function(){
					doBirdAnimation(frame_num+1, bird_frame_pos_array[frame_num+1].left, bird_frame_pos_array[frame_num+1].top);
				}, 80);
				ctx.drawImage(bg_image, 0, 0);
				if(is_sky_blank){
					ctx.drawImage(blank_sky, 0, 0);
				}
				ctx.drawImage(blank_deer, 0, 0);
				ctx.drawImage(bird_animation_array[frame_num], bird_frame_pos_array[frame_num].left, bird_frame_pos_array[frame_num].top);
			}else{
				frame_index = (frame_num%5) + 2;
				setTimeout(function(){
					doBirdAnimation(frame_num+1, new_left, new_top);
				}, 80);
				ctx.save();
				ctx.beginPath();
				ctx.rect(left, top, 86, 86);
				ctx.clip();
				ctx.drawImage(bg_image, 0, 0);
				if(is_sky_blank){
					ctx.drawImage(blank_sky, 0, 0);
				}
				ctx.drawImage(blank_deer, 0, 0);
				ctx.restore();
				ctx.drawImage(bird_animation_array[frame_index], new_left, new_top);
				if(frame_num == 5){
					doFillDeerAnimation(6);
				}
			}
		}else{
			ctx.save();
			ctx.beginPath();
			ctx.rect(left - 35, top + 25, 86, 86);
			ctx.clip();
			ctx.drawImage(bg_image, 0, 0);
			if(is_sky_blank){
			ctx.drawImage(blank_sky, 0, 0);
			}
			ctx.restore();		
		}	
	}
	
	function doBlankDeerAnimation(frame_num)
	{
		var ctx = $('#test_canvas')[0].getContext('2d');
		if(frame_num < 7){
			setTimeout(function(){
				doBlankDeerAnimation(frame_num+1);
			}, 100);
			ctx.drawImage(blank_deer, 0, 0);
			ctx.drawImage(blank_deer_animation_array[frame_num], blank_deer_frame_pos_array[frame_num].left, blank_deer_frame_pos_array[frame_num].top);
		}else{
			ctx.drawImage(blank_deer, 0, 0);
			is_active = false;
		}
	}
	
	function doFillDeerAnimation(frame_num)
	{
		var ctx = $('#test_canvas')[0].getContext('2d');
		if(frame_num > -1){
			setTimeout(function(){
				doFillDeerAnimation(frame_num-1);
			}, 100);
			ctx.drawImage(blank_deer, 0, 0);
			ctx.drawImage(blank_deer_animation_array[frame_num], blank_deer_frame_pos_array[frame_num].left, blank_deer_frame_pos_array[frame_num].top);
		}else{
			ctx.drawImage(bg_image, 0, 0);
			if(is_sky_blank){
				ctx.drawImage(blank_sky, 0, 0);
			}
			is_active = false;
		}
	}
		
	
	function changeCanvas(x, y)
	{
		var ctx = $('#test_canvas')[0].getContext('2d');
		if(!(is_active)){
			if(area_name == 'deer'){
				if(is_deer_blank){
					is_active = true;
					//doFillDeerAnimation(6);
					doBirdAnimation(0, bird_frame_pos_array[0].left, bird_frame_pos_array[0].top);
					is_deer_blank = false;
				}else{
					is_active = true;
					doBlankDeerAnimation(0);	
					is_deer_blank = true;
				}
			}else if(area_name == 'sky'){
				if(is_sky_blank){
				 	ctx.drawImage(bg_image, 0, 0);
					is_sky_blank = false;
					if(is_deer_blank){
						ctx.drawImage(blank_deer, 0, 0);
					}
				}else{
					ctx.drawImage(blank_sky, 0, 0);
					is_sky_blank = true;
				}
			}
		}
	}
	
	</script>
</head>
<body>
	<div id="outer_container">
		<div id="title"> Title </div>
		<div  id="inner_container">
			<div id="sidebar"> Aside </div>
			<div id="content">
				<canvas id="test_canvas" width="700px" height="600px"></canvas>
				<div id="output"></div>
			</div>
		</div>
	</div>
</body>
</html>